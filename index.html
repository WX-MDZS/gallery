<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>作品一覧</title>
<style>
:root{
  --ring:#86c1d3;      /* アイコンの縁色 */
  --pill:#67a7ba;      /* ボタン文字色 R103 G167 B186 */
  --pill-bg:#eef7fb;   /* ボタン背景の薄色 */
  --muted:#888;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:#fff;color:#111;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic UI","Noto Sans JP","Yu Gothic",Meiryo,sans-serif}
h1{margin:.5rem 0 0;font-size:clamp(1.4rem,2.6vw,2.2rem);text-align:center}
.lead{margin:.4rem 0 1rem;text-align:center;color:#444;font-size:.95rem}
.counter{margin:.25rem 0 1.2rem;text-align:center;font-weight:700}
#logo{display:block;margin:22px auto 6px;max-width:min(720px,88vw);height:auto}

/* グリッド（PC=4列／スマホ=2列） */
.gallery{display:grid;grid-template-columns:repeat(4,1fr);gap:28px 22px;max-width:1100px;margin:0 auto 60px;padding:0 16px}
@media (max-width:720px){.gallery{grid-template-columns:repeat(2,1fr)}}

/* カード */
.card{position:relative;text-align:center;border:1px solid #e8edf0;border-radius:16px;background:#fff;padding:22px 10px 70px; /* 下に余白＝ポップアップ置き場 */
  box-shadow:0 8px 26px rgba(0,0,0,.06);transition:transform .12s ease}
.card:hover{transform:translateY(-3px)}
.icon-wrap{position:relative;display:inline-block}
.icon{width:128px;height:128px;border-radius:50%;display:block;object-fit:cover;border:3px solid var(--ring);background:#fff;box-shadow:0 8px 20px rgba(0,0,0,.08)}
.name{margin:.6rem 0 .4rem;font-weight:700;letter-spacing:.02em}

/* ポップアップ（カード内の下に固定） */
.pop{position:absolute;left:0;right:0;bottom:12px;display:flex;gap:10px;justify-content:center;
  opacity:0;transform:translateY(8px);pointer-events:none;transition:opacity .15s,transform .15s}
.card:hover .pop, .card.open .pop{opacity:1;transform:translateY(0);pointer-events:auto}
.pill{display:inline-block;font-size:.9rem;padding:.45rem .9rem;border-radius:999px;border:1px solid var(--pill);text-decoration:none;
  color:var(--pill);background:var(--pill-bg);transition:background .12s,border-color .12s}
.pill:hover{background:rgba(103,167,186,.15)}
/* アクセシビリティ：キーボードで開ける */
.card:focus-within .pop{opacity:1;transform:translateY(0);pointer-events:auto}

/* フッター */
.footer{margin:40px 0 28px;text-align:center;color:#555}
.small{font-size:.9rem;color:#666}
</style>
</head>
<body>

<img id="logo" src="assets/title.jpg" alt="企画ロゴ" />
<h1>作品一覧</h1>
<p class="lead">アイコン＝X、ポップアップのボタン＝作品・感想</p>
<p class="counter">あなたは「<span id="vis">000000</span>」人目の姑蘇藍氏の弟子</p>

<div id="gallery" class="gallery" aria-live="polite"></div>

<p class="footer small">雲隠探情企画 / 主催はくと</p>

<script>
/* ===== ここだけ編集してください ===== */
const CSV_URL = "<<< ここに“ウェブ公開の CSV”URLを貼る >>>";
/* 例:
   https://docs.google.com/spreadsheets/d/e/XXXX/pub?gid=0&single=true&output=csv
*/

/* ===== カウンター（6桁） ===== */
(function(){
  const key="mdzs_visit_count";
  let n = +(localStorage.getItem(key)||0);
  n++; localStorage.setItem(key,n);
  document.getElementById("vis").textContent = String(n).padStart(6,"0");
})();

/* ===== CSV 読み込み・描画 ===== */
async function loadCSV(url){
  try{
    if(!url || /<<</.test(url)) throw new Error("CSV_URL 未設定");
    const res = await fetch(url, {cache:"no-store"});
    if(!res.ok) throw new Error(res.status + " " + res.statusText);
    const text = await res.text();
    // 1行目ヘッダを想定：A=icon名(拡張子なし), B=名前, C=Xリンク, D=作品, E=感想
    return text.trim().split(/\r?\n/).slice(1).map(line=>{
      // シンプルCSV（カンマ含む場合は事前にシートで除去してください）
      const cols = line.split(",");
      return {
        icon:(cols[0]||"").trim(),
        name:(cols[1]||"").trim(),
        twitter:(cols[2]||"").trim(),
        work:(cols[3]||"").trim(),
        feedback:(cols[4]||"").trim(),
      };
    });
  }catch(e){
    console.warn("CSV読み込み失敗:",e);
    return null;
  }
}

function createCard(row){
  const card = document.createElement("div");
  card.className = "card";
  card.tabIndex = 0;

  // アイコンはXリンクに
  const iconWrap = document.createElement("a");
  iconWrap.className = "icon-wrap";
  iconWrap.href = row.twitter || "#";
  iconWrap.target = row.twitter ? "_blank" : "_self";
  iconWrap.rel = "noopener";
  const img = document.createElement("img");
  img.className = "icon";
  img.alt = row.name || "icon";
  img.src = `icons/${row.icon || "01"}.png`;
  iconWrap.appendChild(img);

  const name = document.createElement("div");
  name.className = "name";
  name.textContent = row.name || "";

  const pop = document.createElement("div");
  pop.className = "pop";
  const toWork = document.createElement("a");
  toWork.className = "pill";
  toWork.textContent = "作品へ";
  toWork.href = row.work || "#";
  toWork.target = row.work ? "_blank" : "_self";
  toWork.rel = "noopener";

  const toFb = document.createElement("a");
  toFb.className = "pill";
  toFb.textContent = "感想へ";
  toFb.href = row.feedback || "#";
  toFb.target = row.feedback ? "_blank" : "_self";
  toFb.rel = "noopener";

  pop.appendChild(toWork);
  pop.appendChild(toFb);

  // クリック/タップでポップアップ固定
  card.addEventListener("click", (e)=>{
    // ボタンそのものをクリックした時は何もしない
    if(e.target.closest(".pill")) return;
    card.classList.toggle("open");
  });

  // ESCで閉じる
  card.addEventListener("keydown",(e)=>{
    if(e.key === "Escape") card.classList.remove("open");
  });

  card.append(iconWrap,name,pop);
  return card;
}

(async function init(){
  const g = document.getElementById("gallery");
  g.textContent = "";

  let rows = await loadCSV(CSV_URL);
  // 失敗時は仮データ 4×8 = 32件
  if(!rows || !rows.length){
    rows = Array.from({length:24},(_,i)=>({
      icon:String(i%8+1).padStart(2,"0"),
      name:`No.${i+1}`,
      twitter:"#",
      work:"#",
      feedback:"#"
    }));
  }

  rows.forEach(r=>g.appendChild(createCard(r)));
})();
</script>
</body>
</html>
