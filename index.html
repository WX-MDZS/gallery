<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>雲隠深情 | 作品一覧</title>
<style>
:root{
  --accent: rgb(103,167,186);
  --shadow: 0 10px 24px rgba(0,0,0,.08);
  --shadow-hover: 0 18px 36px rgba(0,0,0,.14);
  --icon-size: 124px;
  --card-w: 260px;            /* ← カードの幅を固定 */
}

/* base */
*{box-sizing:border-box}
html,body{background:#fff;color:#222;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Hiragino Sans",Meiryo,sans-serif}
body{margin:0;padding:0 0 56px;text-align:center}

/* header（ロゴは現状そのまま） */
header{padding:24px 10px 10px}
header img{width:min(880px,92vw);height:auto;display:block;margin:0 auto}

/* カウンターを大きく太く */
.counter{
  margin: 10px auto 8px;
  width:min(920px,92vw);
  font-weight: 900;
  font-size: clamp(20px, 2.8vw, 30px);   /* ← 大きめ */
  line-height: 1.3;
}
.counter .num{letter-spacing:.06em}
.desc{margin: 6px 0 0; font-size: .95rem; color:#555;}

/* 作品一覧は少し小さく（位置は据え置き） */
.section-title{
  margin: 22px 0 32px;                 /* 2 行ぶんの余白は維持 */
  font-weight: 700;
  font-size: clamp(18px, 2.0vw, 22px);  /* ← 控えめに */
}

/* 注意表示（見出し推測など） */
.notice{
  background:#fff9e6;
  border:1px solid #f2e2b6;
  color:#7a5a00;
  width:min(1000px,92vw);
  margin: 0 auto 18px;
  padding: 12px 14px;
  border-radius: 12px;
  text-align:left;
  display:none;
}

/* grid：カードサイズは固定、列数だけ自動調整 */
.gallery{
  width:min(1140px,94vw);
  margin: 0 auto;
  display:grid;
  grid-template-columns: repeat(auto-fit, var(--card-w)); /* ← 固定幅で並べる */
  justify-content: center;     /* 余白は中央寄せ */
  gap: 28px;
}

/* card */
.card{
  position:relative;
  width: var(--card-w);         /* ← 幅固定 */
  background:#fff;
  border-radius:18px;
  padding: 18px 10px 14px;
  box-shadow: var(--shadow);
  transition: box-shadow .2s ease, transform .2s ease;
}
.card:hover{ box-shadow: var(--shadow-hover); transform: translateY(-2px); }

/* icon */
.icon-wrap{
  width: var(--icon-size);
  height: var(--icon-size);
  margin: 0 auto 12px;
  border-radius: 50%;
  overflow: hidden;
  border: 4px solid rgba(103,167,186,.28);
  outline: 2px solid var(--accent);
  outline-offset: -6px;
  background:#f3f4f6;
  position:relative;
  transition: filter .18s;
}
.icon-wrap:hover{ filter: saturate(1.04) }

/* 画像 */
.icon{width:100%;height:100%;object-fit:cover;display:block}

/* ポップアップ（ボタン2個：横並び） */
.pop{
  display: flex;
  flex-direction: row !important; /* ← 縦化を阻止 */
  gap: 10px;
  justify-content:center;
  align-items:center;
  position: absolute;
  left: 50%;
  transform: translate(-50%, 0);
  top: calc(var(--icon-size) + 10px);  /* アイコン直下 */
  padding: 6px 8px;
  border-radius: 12px;
  background:#fff;
  border:1px solid rgba(0,0,0,.08);
  box-shadow: 0 10px 24px rgba(0,0,0,.14);
  z-index: 10;
  opacity: 0;
  pointer-events: none;
  transition: opacity .18s ease, transform .18s ease;
}

/* hover/tap で表示 */
.card:hover .pop,
.card.pop-open .pop{ opacity:1; pointer-events:auto; }

/* pill（色は R103 G167 B186） */
.pill{
  display:inline-block;
  min-width:64px;
  padding: .38rem .7rem;
  border-radius:999px;
  line-height:1;
  border:1px solid var(--accent);
  color: var(--accent);
  background:#fff;
  text-decoration:none;
  font-size:.95rem;
  white-space:nowrap;
  box-shadow: 0 2px 0 rgba(103,167,186,.08);
  transition: background .12s, transform .06s;
}
.pill:hover{ background: rgba(103,167,186,.12) }
.pill:active{ transform: translateY(1px) }

/* 名前（Twitter へのリンク・黒のまま） */
.name{
  margin: 48px 0 4px;  /* ポップアップの分だけ余白確保 */
  font-weight: 700;
  font-size: 1.02rem;
}
.name a{ color:#111; text-decoration:none; }
.name a:focus-visible{ outline:2px solid var(--accent) }

/* footer */
footer{margin: 30px 0 0; color:#666; font-size:.9rem}
</style>
</head>
<body>

<header>
  <img src="./assets/title.jpg" alt="雲隠深情">
</header>

<p class="counter">
  あなたは「<span class="num" id="visitor">000000</span>」人目の姑蘇藍氏の先輩
</p>
<p class="desc">アイコン＝Twitter、ポップアップのボタン＝作品・感想</p>

<h1 class="section-title">作品一覧</h1>

<p id="notice" class="notice"></p>

<section id="gallery" class="gallery" aria-live="polite"></section>

<footer>雲隠探情企画 / 主催はくと</footer>

<script>
/* ====== 設定 ====== */
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQLr1090BcgO8C08pdp3UHuN73zUFB68OyW47BSihAvvVxbwDtMBwK0st9tJpg8nqpNTR0m4QHjcVs4/pub?output=csv";

/* ====== 訪問カウンター（先輩） ====== */
(() => {
  try{
    const el = document.getElementById('visitor');
    let n = Number(localStorage.getItem('mdzs_counter')||0) + 1;
    localStorage.setItem('mdzs_counter', n);
    el.textContent = String(n).padStart(6,'0');
  }catch(_){}
})();

/* ====== CSV 読み込み ====== */
async function loadCSV(url){
  const res = await fetch(url, {cache:'no-store'});
  const text = await res.text();
  const lines = text.replace(/^\uFEFF/,'').trim().split(/\r?\n/);
  if(!lines.length) return [];

  // 1行目の見出しチェック
  const header = lines[0].split(',').map(s=>s.trim());
  const expected = ["アイコン","名前","ツイッター","作品","感想"];
  const ok = expected.every((h,i)=>header[i]===h);

  if(!ok){
    const n = document.getElementById('notice');
    n.style.display = 'block';
    n.textContent = "CSVの見出しが判定できなかったため、列の並び（アイコン/名前/ツイッター/作品/感想）で推測して読み込みました。見出しを付け直すとより安全です。";
  }

  return lines.slice(1).map(line=>{
    const cols = line.split(',').map(s=>s.trim());
    return {
      アイコン: cols[0]||"",
      名前:     cols[1]||"",
      ツイッター:cols[2]||"",
      作品:     cols[3]||"",
      感想:     cols[4]||""
    };
  });
}

/* ====== カード描画 ====== */
function makeCard({アイコン, 名前, ツイッター, 作品, 感想}){
  const card = document.createElement('div');
  card.className = 'card';

  // icon
  const iconWrap = document.createElement('div');
  iconWrap.className = 'icon-wrap';
  const img = document.createElement('img');
  img.className = 'icon';
  img.alt = `${名前} のアイコン`;
  img.src = `./icons/${アイコン}`;
  iconWrap.appendChild(img);
  card.appendChild(iconWrap);

  // popup
  const pop = document.createElement('div');
  pop.className = 'pop';
  const toWork = Object.assign(document.createElement('a'), {
    className:'pill', href: 作品||'#', target:'_blank', rel:'noopener', textContent:'作品'
  });
  const toFb = Object.assign(document.createElement('a'), {
    className:'pill', href: 感想||'#', target:'_blank', rel:'noopener', textContent:'感想'
  });
  pop.appendChild(toWork);
  pop.appendChild(toFb);
  card.appendChild(pop);

  // name
  const name = document.createElement('div');
  name.className = 'name';
  const tw = Object.assign(document.createElement('a'), {
    href: ツイッター||'#', target:'_blank', rel:'noopener', textContent: 名前||''
  });
  name.appendChild(tw);
  card.appendChild(name);

  // mobile toggle
  iconWrap.addEventListener('click', e=>{
    e.preventDefault(); e.stopPropagation();
    card.classList.toggle('pop-open');
  });
  iconWrap.tabIndex = 0;
  iconWrap.addEventListener('keydown', e=>{
    if(e.key==='Enter'||e.key===' '){ e.preventDefault(); card.classList.toggle('pop-open'); }
  });
  document.addEventListener('click', e=>{
    if(!card.contains(e.target)) card.classList.remove('pop-open');
  });

  return card;
}

/* ====== init ====== */
(async ()=>{
  try{
    const rows = await loadCSV(CSV_URL);
    const wrap = document.getElementById('gallery');
    wrap.innerHTML = '';
    rows.forEach(r=> wrap.appendChild(makeCard(r)));
  }catch(err){
    const n = document.getElementById('notice');
    n.style.display = 'block';
    n.textContent = 'CSVの読み込みに失敗しました。時間をおいて再読み込みしてください。';
    console.error(err);
  }
})();
</script>
</body>
</html>
