<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>作品一覧</title>

<style>
:root{
  --accent: rgb(103,167,186);
  --ring: rgba(103,167,186,.35);
  --text: #222;
}

/* 全体 */
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;color:var(--text);background:#fff}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}

.header{max-width:980px;margin:28px auto 6px;padding:0 16px;text-align:center}
.header img{max-width:820px;width:100%;height:auto;display:block;margin:0 auto}

h1{margin:18px 0 8px;font-size:clamp(1.25rem,1.1rem + 1.2vw,1.8rem);text-align:center}
.lead{margin:0 0 14px;text-align:center;color:#555}
.counter{margin:6px 0 22px;text-align:center;font-weight:800;font-size:clamp(1rem,.9rem + .8vw,1.3rem)}
.counter .digits{font-variant-numeric:tabular-nums;letter-spacing:.08em}

/* ギャラリー */
.wrap{max-width:1100px;margin:0 auto;padding:0 16px 64px}
.gallery{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
  gap:26px 22px;
  justify-items:center;
}

/* カード */
.card{
  width:190px;
  position:relative;
  text-align:center;
  padding:1rem .6rem 1.15rem;
  border:1px solid var(--ring);
  border-radius:14px;
  background:#fff;
  transition:transform .18s, box-shadow .18s;
  overflow:hidden;
}
.card:hover,.card:focus-within{transform:translateY(-3px);box-shadow:0 12px 26px rgba(0,0,0,.08)}

/* アイコン */
.icon-wrap{position:relative;display:inline-block;z-index:20;padding-bottom:12px}
.icon{
  width:104px;height:104px;border-radius:50%;object-fit:cover;background:#f3f4f6;
  display:block;margin:0 auto .6rem;box-shadow:0 2px 8px rgba(0,0,0,.06);
  transition:transform .18s,box-shadow .18s,filter .18s
}
.card:hover .icon,.card:focus-within .icon{
  transform:scale(1.035);box-shadow:0 12px 28px rgba(0,0,0,.12);filter:saturate(1.03)
}

/* ポップアップ（初期は非表示） */
.pop{
  position:absolute;left:50%;top:calc(100% + 8px);
  transform:translateX(-50%) scale(.98);
  opacity:0;pointer-events:none;
  background:#fff;border:1px solid var(--ring);border-radius:10px;
  box-shadow:0 12px 26px rgba(0,0,0,.08);
  padding:.55rem .65rem;white-space:nowrap;z-index:100;
  transition:opacity .15s, transform .15s;
}
.pop::after{
  content:"";position:absolute;left:50%;bottom:100%;transform:translateX(-50%);
  border:8px solid transparent;border-bottom-color:#fff;filter:drop-shadow(0 1px 0 var(--ring));
}
.card:hover .pop,.card:focus-within .pop,.card.pop-open .pop{
  opacity:1;transform:translateX(-50%) scale(1);pointer-events:auto;
}

/* 名前（黒文字・装飾なし） */
.name{
  font-size:.97rem;font-weight:800;margin:.55rem 0 .35rem;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  position:relative;z-index:10;color:var(--text);
}

/* ボタン */
.pill{
  display:inline-block;font-size:.86rem;padding:.32rem .68rem;margin:0 .18rem;
  border-radius:999px;border:1px solid var(--accent);background:#f8fafc;color:var(--accent);
  transition:background .12s,border-color .12s,color .12s;text-decoration:none
}
.pill:hover{background:rgba(103,167,186,.15)}

/* フッタ */
.footer{margin:40px 0 10px;text-align:center;color:#777}

/* スマホ */
@media (max-width:520px){
  .gallery{grid-template-columns:repeat(2,160px)}
  .card{width:160px}
  .icon{width:96px;height:96px}
  .icon-wrap{padding-bottom:20px}
}
</style>
</head>
<body>

  <!-- タイトル画像 -->
  <div class="header">
    <img src="./assets/title.jpg" alt="雲隠深情" />
  </div>

  <div class="wrap">
    <h1>作品一覧</h1>
    <p class="lead">アイコン＝X、ポップアップのボタン＝作品・感想</p>

    <!-- カウンター -->
    <p class="counter">あなたは「<span id="count" class="digits">000000</span>」人目の姑蘇藍氏の弟子</p>

    <!-- ギャラリー -->
    <div id="gallery" class="gallery" aria-live="polite"></div>

    <p class="footer">雲隠深情企画 / 主催はくと</p>
  </div>

<script>
/* =========================
   設定
========================= */
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQLr1090BcgO8C08pdp3UHuN73zUFB68OyW47BSihAvvVxbwDtMBwK0st9tJpg8nqpNTR0m4QHjcVs4/pub?gid=0&single=true&output=csv";

/* 簡易カウンター */
(function counter(){
  try{
    const KEY="yd_gallery_counter_v1";
    let n = Number(localStorage.getItem(KEY) || "0");
    n += 1;
    localStorage.setItem(KEY, String(n));
    document.getElementById("count").textContent = String(n).padStart(6,"0");
  }catch(e){}
})();

/* CSV読み込み */
async function loadCSV(url){
  const res = await fetch(url, {cache:"no-store"});
  const text = await res.text();
  const rows = [];
  let i = 0, cur = "", inQ = false, row = [];
  while(i < text.length){
    const c = text[i++];
    if(c === '"'){ inQ = !inQ; continue; }
    if(!inQ && (c === "," || c === "\n" || c === "\r")){
      row.push(cur.trim()); cur = "";
      if(c === "\n" || c === "\r"){ if(row.length) rows.push(row); row = []; }
    }else{
      cur += c;
    }
  }
  if(cur.length || row.length){ row.push(cur.trim()); rows.push(row); }
  return rows.filter(r => r.length >= 3).slice(1);
}

function createCard([iconName, displayName, twitter, work, feedback]){
  const card = document.createElement("div");
  card.className = "card";

  const wrap = document.createElement("div");
  wrap.className = "icon-wrap";

  const tw = document.createElement("a");
  tw.href = twitter || "#";
  tw.target = "_blank"; tw.rel = "noopener";

  const img = document.createElement("img");
  const file = (iconName || "").replace(/\.(png|jpg|jpeg|webp)$/i,"");
  img.src = "./icons/" + file + ".png";
  img.alt = displayName || "";
  img.className = "icon";

  tw.appendChild(img);
  wrap.appendChild(tw);
  card.appendChild(wrap);

  const name = document.createElement("div");
  name.className = "name";
  name.textContent = displayName || "";
  card.appendChild(name);

  const pop = document.createElement("div");
  pop.className = "pop";
  const toWork = document.createElement("a");
  toWork.className = "pill"; toWork.textContent = "作品へ";
  toWork.href = work || "#"; toWork.target="_blank"; toWork.rel="noopener";
  const toFb = document.createElement("a");
  toFb.className = "pill"; toFb.textContent = "感想へ";
  toFb.href = feedback || "#"; toFb.target="_blank"; toFb.rel="noopener";
  pop.appendChild(toWork); pop.appendChild(toFb);
  card.appendChild(pop);

  card.addEventListener("touchstart", e=>{
    if(!card.classList.contains("pop-open")) card.classList.add("pop-open");
  }, {passive:true});
  card.addEventListener("keydown", e=>{
    if(e.key==="Escape") card.classList.remove("pop-open");
  });

  return card;
}

(async function init(){
  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "";
  try{
    const rows = await loadCSV(CSV_URL);
    rows.forEach(r => gallery.appendChild(createCard(r)));
  }catch(err){
    gallery.textContent = "データの読み込みに失敗しました。";
  }
})();
</script>
</body>
</html>
